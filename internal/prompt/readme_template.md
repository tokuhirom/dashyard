# Dashyard Gen-Prompt Output

This directory contains everything you need to generate and run Dashyard monitoring dashboards.

## Files

| File | Purpose | Regenerated on re-run? |
|------|---------|----------------------|
| `DASHYARD-USAGE.md` | This guide | Yes (always updated) |
| `config.yaml` | Dashyard server configuration | No (write-once) |
| `prompt-system.md` | LLM prompt with guidelines and format reference | Yes (always updated) |
| `prompt-user.md` | Your custom instructions for the LLM | No (write-once) |
| `prompt-metrics.md` | Available metrics from your Prometheus | Yes (always updated) |
| `dashboards/` | Dashboard YAML files generated by the LLM | Not touched by gen-prompt |

## Workflow

1. **Generate the prompt** — Run `dashyard gen-prompt` to create this directory with the prompt files and config.
2. **Feed to an LLM** — Pass `prompt-system.md`, `prompt-user.md`, and `prompt-metrics.md` to an LLM and ask it to generate dashboards.
3. **Save dashboards** — Place the generated YAML files in the `dashboards/` directory.
4. **View dashboards** — Start the Dashyard server and open it in your browser.

### Using Claude Code

```bash
# In this directory, start Claude Code and ask it to generate dashboards:
claude

# Example prompt inside Claude Code:
# "Read prompt-system.md, prompt-user.md, and prompt-metrics.md, then generate dashboards for all available metrics into the dashboards/ directory."
```

Claude Code will read the prompt files, understand the available metrics, and create dashboard YAML files in the `dashboards/` directory.

### Re-running gen-prompt

When your Prometheus metrics change, re-run `gen-prompt` to update the metrics list:

```bash
dashyard gen-prompt <prometheus-url> -o .
```

System files (`DASHYARD-USAGE.md`, `prompt-system.md`, `prompt-metrics.md`) are always updated. Your `prompt-user.md`, `config.yaml`, and `dashboards/` are preserved.

## Customizing the Prompt

`prompt-user.md` is yours to edit freely — it won't be overwritten on subsequent runs. You can customize it to:

- **Focus on a specific domain** — e.g. "Only generate dashboards for JVM and HTTP metrics"
- **Set layout preferences** — e.g. "Use 3 panels per row" or "Always include a markdown overview panel"
- **Define default thresholds** — e.g. "CPU warning at 80%, critical at 95%"
- **Request specific dashboard structure** — e.g. "Create separate dashboards for each service"
- **Add organization-specific context** — e.g. "Our SLO target is 99.9% availability"

## Configuring config.yaml

The generated `config.yaml` contains your Prometheus datasource configuration:

```yaml
datasources:
  - name: default
    type: prometheus
    url: "http://your-prometheus:9090"
    timeout: 30s
    default: true
```

### Authentication with Headers

Add custom HTTP headers for authentication. Use `${VAR}` syntax to reference environment variables:

```yaml
datasources:
  - name: default
    type: prometheus
    url: "https://prometheus.example.com"
    timeout: 30s
    default: true
    headers:
      - name: Authorization
        value: "Bearer ${PROMETHEUS_TOKEN}"
```

## Multiple Datasources

You can define multiple Prometheus instances and switch between them:

```yaml
datasources:
  - name: prod
    type: prometheus
    url: "https://prometheus-prod.example.com"
    timeout: 30s
    default: true
  - name: staging
    type: prometheus
    url: "https://prometheus-staging.example.com"
    timeout: 30s
```

### Referencing datasources in dashboards

Panels can specify which datasource to query:

```yaml
rows:
  - title: "API Latency"
    panels:
      - title: "p99 Latency"
        type: graph
        query: 'histogram_quantile(0.99, rate(http_request_duration_seconds_bucket[5m]))'
        datasource: "prod"
```

### Datasource selector variable

Add a `type: datasource` variable to let users switch datasources from a dropdown:

```yaml
variables:
  - name: env
    type: datasource
    label: "Environment"
rows:
  - title: "API Latency"
    panels:
      - title: "p99 Latency"
        type: graph
        query: 'histogram_quantile(0.99, rate(http_request_duration_seconds_bucket[5m]))'
        datasource: "$env"
```

## Viewing Dashboards

Start the Dashyard server pointing to this directory:

```bash
dashyard serve --config config.yaml --dashboards-dir dashboards
```

Then open http://localhost:8080 in your browser.
