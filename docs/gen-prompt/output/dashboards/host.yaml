title: "Host Metrics"
variables:
  - name: device
    label: "Network Device"
    query: "label_values(system_network_io_bytes_total, device)"
  - name: disk
    label: "Disk Device"
    query: "label_values(system_disk_io_bytes_total, device)"
rows:
  - title: "Overview"
    panels:
      - title: "About"
        type: markdown
        content: |
          Host-level metrics collected via OpenTelemetry system scrapers.
          Covers CPU, memory, disk I/O, and network I/O.

  - title: "CPU"
    panels:
      - title: "CPU Time by State"
        type: graph
        query: 'sum by (state) (rate(system_cpu_time_seconds_total[5m]))'
        unit: count
        chart_type: area
        stacked: true
        legend: "{state}"
        y_min: 0
      - title: "CPU User vs System"
        type: graph
        query: 'sum(rate(system_cpu_time_seconds_total{state="user"}[5m]))'
        unit: count
        y_min: 0
      - title: "CPU Idle"
        type: graph
        query: 'sum(rate(system_cpu_time_seconds_total{state="idle"}[5m]))'
        unit: count
        y_min: 0

  - title: "Memory"
    panels:
      - title: "Memory Usage by State"
        type: graph
        query: 'system_memory_usage_bytes'
        unit: bytes
        chart_type: area
        stacked: true
        legend: "{state}"
        y_min: 0

  - title: "Disk I/O - $disk"
    repeat: disk
    panels:
      - title: "Disk Read Rate ($disk)"
        type: graph
        query: 'rate(system_disk_io_bytes_total{device="$disk", direction="read"}[5m])'
        unit: bytes
        y_min: 0
      - title: "Disk Write Rate ($disk)"
        type: graph
        query: 'rate(system_disk_io_bytes_total{device="$disk", direction="write"}[5m])'
        unit: bytes
        y_min: 0
      - title: "Disk IOPS ($disk)"
        type: graph
        query: 'rate(system_disk_operations_total{device="$disk"}[5m])'
        unit: count
        chart_type: bar
        legend: "{direction}"
        y_min: 0
      - title: "Disk Pending Operations ($disk)"
        type: graph
        query: 'system_disk_pending_operations{device="$disk"}'
        unit: count
        y_min: 0
        thresholds:
          - value: 10
            color: "#f59e0b"
            label: "Warning"
          - value: 50
            color: "#ef4444"
            label: "Critical"
      - title: "Disk I/O Time ($disk)"
        type: graph
        query: 'rate(system_disk_io_time_seconds_total{device="$disk"}[5m])'
        unit: seconds
        y_min: 0
      - title: "Disk Avg Operation Time ($disk)"
        type: graph
        query: 'rate(system_disk_operation_time_seconds_total{device="$disk"}[5m]) / rate(system_disk_operations_total{device="$disk"}[5m])'
        unit: seconds
        legend: "{direction}"
        y_min: 0

  - title: "Network - $device"
    repeat: device
    panels:
      - title: "Bytes Received ($device)"
        type: graph
        query: 'rate(system_network_io_bytes_total{device="$device", direction="receive"}[5m])'
        unit: bytes
        y_min: 0
      - title: "Bytes Transmitted ($device)"
        type: graph
        query: 'rate(system_network_io_bytes_total{device="$device", direction="transmit"}[5m])'
        unit: bytes
        y_min: 0
      - title: "Packets ($device)"
        type: graph
        query: 'rate(system_network_packets_total{device="$device"}[5m])'
        unit: count
        chart_type: bar
        legend: "{direction}"
        y_min: 0
      - title: "Errors ($device)"
        type: graph
        query: 'rate(system_network_errors_total{device="$device"}[5m])'
        unit: count
        legend: "{direction}"
        y_min: 0
        thresholds:
          - value: 1
            color: "#f59e0b"
            label: "Warning"
      - title: "Dropped ($device)"
        type: graph
        query: 'rate(system_network_dropped_total{device="$device"}[5m])'
        unit: count
        legend: "{direction}"
        y_min: 0
        thresholds:
          - value: 1
            color: "#f59e0b"
            label: "Warning"

  - title: "Network Connections"
    panels:
      - title: "TCP Connections by State"
        type: graph
        query: 'system_network_connections{protocol="tcp"}'
        unit: count
        chart_type: area
        stacked: true
        legend: "{state}"
        y_min: 0
