{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://github.com/tokuhirom/dashyard/schemas/dashboard.schema.json",
  "title": "Dashyard Dashboard",
  "description": "A dashboard definition file for Dashyard.",
  "type": "object",
  "properties": {
    "title": {
      "type": "string",
      "description": "Display title of the dashboard."
    },
    "variables": {
      "type": "array",
      "description": "Template variables populated from Prometheus label values.",
      "items": {
        "$ref": "#/$defs/variable"
      }
    },
    "rows": {
      "type": "array",
      "description": "Horizontal rows of panels.",
      "items": {
        "$ref": "#/$defs/row"
      }
    }
  },
  "required": ["title", "rows"],
  "additionalProperties": false,
  "$defs": {
    "variable": {
      "type": "object",
      "description": "A template variable populated from Prometheus label values.",
      "properties": {
        "name": {
          "type": "string",
          "description": "Variable name used in PromQL templates as $name or ${name}."
        },
        "label": {
          "type": "string",
          "description": "Display label for the variable dropdown. Defaults to name if omitted."
        },
        "query": {
          "type": "string",
          "description": "Query to populate values, e.g. label_values(metric, label)."
        },
        "datasource": {
          "type": "string",
          "description": "Name of the datasource to query. Uses the default datasource when omitted."
        }
      },
      "required": ["name", "query"],
      "additionalProperties": false
    },
    "row": {
      "type": "object",
      "description": "A horizontal row containing one or more panels.",
      "properties": {
        "title": {
          "type": "string",
          "description": "Display title of the row."
        },
        "repeat": {
          "type": "string",
          "description": "Variable name to repeat this row for each value of the variable."
        },
        "panels": {
          "type": "array",
          "description": "Panels within this row.",
          "items": {
            "$ref": "#/$defs/panel"
          }
        }
      },
      "required": ["title", "panels"],
      "additionalProperties": false
    },
    "panel": {
      "type": "object",
      "description": "A single visualization panel.",
      "oneOf": [
        { "$ref": "#/$defs/graphPanel" },
        { "$ref": "#/$defs/markdownPanel" }
      ]
    },
    "graphPanel": {
      "type": "object",
      "description": "A Prometheus graph panel.",
      "properties": {
        "title": {
          "type": "string",
          "description": "Display title of the panel."
        },
        "type": {
          "const": "graph"
        },
        "query": {
          "type": "string",
          "description": "PromQL query expression."
        },
        "datasource": {
          "type": "string",
          "description": "Name of the datasource to query. Uses the default datasource when omitted."
        },
        "unit": {
          "type": "string",
          "description": "Unit for formatting values on the Y axis.",
          "enum": ["bytes", "percent", "count", "seconds"]
        },
        "chart_type": {
          "type": "string",
          "description": "Chart visualization type. Defaults to 'line' if omitted.",
          "enum": ["line", "bar", "area", "scatter"],
          "default": "line"
        },
        "legend": {
          "type": "string",
          "description": "Go template string for formatting legend labels. Metric label names can be used as placeholders (e.g. \"{{device}} {{direction}}\")."
        },
        "y_min": {
          "type": "number",
          "description": "Explicit minimum value for the Y axis. Overrides unit-based defaults (e.g. 0 for percent)."
        },
        "y_max": {
          "type": "number",
          "description": "Explicit maximum value for the Y axis. Overrides unit-based defaults (e.g. 100 for percent)."
        },
        "thresholds": {
          "type": "array",
          "description": "Horizontal reference lines drawn on the chart.",
          "items": {
            "$ref": "#/$defs/threshold"
          }
        },
        "stacked": {
          "type": "boolean",
          "description": "Stack series on top of each other. Applies to line, area, and bar charts.",
          "default": false
        },
        "y_scale": {
          "type": "string",
          "description": "Y-axis scale type. Defaults to 'linear' if omitted.",
          "enum": ["linear", "log"],
          "default": "linear"
        }
      },
      "required": ["title", "type", "query"],
      "additionalProperties": false
    },
    "threshold": {
      "type": "object",
      "description": "A horizontal threshold line on a graph panel.",
      "properties": {
        "value": {
          "type": "number",
          "description": "Y-axis value where the line is drawn."
        },
        "color": {
          "type": "string",
          "description": "CSS color for the line. Defaults to '#ef4444' (red) when omitted.",
          "default": "#ef4444"
        },
        "label": {
          "type": "string",
          "description": "Text label displayed at the end of the line."
        }
      },
      "required": ["value"],
      "additionalProperties": false
    },
    "markdownPanel": {
      "type": "object",
      "description": "A panel that renders Markdown content.",
      "properties": {
        "title": {
          "type": "string",
          "description": "Display title of the panel."
        },
        "type": {
          "const": "markdown"
        },
        "content": {
          "type": "string",
          "description": "Markdown text to render."
        },
        "full_width": {
          "type": "boolean",
          "description": "When true, the panel spans the full row width instead of sharing columns with sibling panels.",
          "default": false
        }
      },
      "required": ["title", "type", "content"],
      "additionalProperties": false
    }
  }
}
