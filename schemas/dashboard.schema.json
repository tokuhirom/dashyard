{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://github.com/tokuhirom/dashyard/schemas/dashboard.schema.json",
  "title": "Dashyard Dashboard",
  "description": "A dashboard definition file for Dashyard.",
  "type": "object",
  "properties": {
    "title": {
      "type": "string",
      "description": "Display title of the dashboard."
    },
    "variables": {
      "type": "array",
      "description": "Template variables populated from Prometheus label values.",
      "items": {
        "$ref": "#/$defs/variable"
      }
    },
    "rows": {
      "type": "array",
      "description": "Horizontal rows of panels.",
      "items": {
        "$ref": "#/$defs/row"
      }
    }
  },
  "required": ["title", "rows"],
  "additionalProperties": false,
  "$defs": {
    "variable": {
      "type": "object",
      "description": "A template variable. Type 'query' (default) populates from Prometheus label values; type 'datasource' populates from configured datasource names.",
      "properties": {
        "name": {
          "type": "string",
          "description": "Variable name used in PromQL templates as $name or ${name}."
        },
        "type": {
          "type": "string",
          "description": "Variable type: 'query' (default) for Prometheus label values, 'datasource' for switching between configured datasources.",
          "enum": ["query", "datasource"],
          "default": "query"
        },
        "label": {
          "type": "string",
          "description": "Display label for the variable dropdown. Defaults to name if omitted."
        },
        "query": {
          "type": "string",
          "description": "Query to populate values, e.g. label_values(metric, label). Required for type 'query', forbidden for type 'datasource'."
        },
        "datasource": {
          "type": "string",
          "description": "Name of the datasource to query. Uses the default datasource when omitted. Forbidden for type 'datasource'."
        },
        "hide": {
          "type": "boolean",
          "description": "When true, hide this variable from the selector bar. The variable still works in queries and repeat rows.",
          "default": false
        }
      },
      "required": ["name"],
      "additionalProperties": false
    },
    "row": {
      "type": "object",
      "description": "A horizontal row containing one or more panels.",
      "properties": {
        "title": {
          "type": "string",
          "description": "Display title of the row."
        },
        "repeat": {
          "type": "string",
          "description": "Variable name to repeat this row for each value of the variable."
        },
        "panels": {
          "type": "array",
          "description": "Panels within this row.",
          "items": {
            "$ref": "#/$defs/panel"
          }
        }
      },
      "required": ["title", "panels"],
      "additionalProperties": false
    },
    "panel": {
      "type": "object",
      "description": "A single visualization panel.",
      "oneOf": [
        { "$ref": "#/$defs/graphPanel" },
        { "$ref": "#/$defs/markdownPanel" }
      ]
    },
    "graphPanel": {
      "type": "object",
      "description": "A Prometheus graph panel.",
      "properties": {
        "title": {
          "type": "string",
          "description": "Display title of the panel."
        },
        "type": {
          "const": "graph"
        },
        "query": {
          "type": "string",
          "description": "PromQL query expression."
        },
        "datasource": {
          "type": "string",
          "description": "Name of the datasource to query. Uses the default datasource when omitted."
        },
        "unit": {
          "type": "string",
          "description": "Unit for formatting values on the Y axis.",
          "enum": ["bytes", "percent", "count", "seconds"]
        },
        "chart_type": {
          "type": "string",
          "description": "Chart visualization type. Defaults to 'line' if omitted.",
          "enum": ["line", "bar", "area", "scatter"],
          "default": "line"
        },
        "legend": {
          "type": "string",
          "description": "Go template string for formatting legend labels. Metric label names can be used as placeholders (e.g. \"{{device}} {{direction}}\")."
        },
        "legend_display": {
          "type": "boolean",
          "description": "Whether to show the legend. Defaults to true.",
          "default": true
        },
        "legend_position": {
          "type": "string",
          "description": "Position of the legend relative to the chart. Defaults to 'bottom'.",
          "enum": ["top", "bottom", "left", "right"],
          "default": "bottom"
        },
        "legend_align": {
          "type": "string",
          "description": "Alignment of legend labels within the legend box. Defaults to 'start' (left-aligned).",
          "enum": ["start", "center", "end"],
          "default": "start"
        },
        "legend_max_height": {
          "type": "integer",
          "description": "Maximum height of the legend area in pixels. Useful for panels with many series.",
          "minimum": 0
        },
        "legend_max_width": {
          "type": "integer",
          "description": "Maximum width of the legend area in pixels. Useful when legend is positioned left or right.",
          "minimum": 0
        },
        "y_min": {
          "type": "number",
          "description": "Explicit minimum value for the Y axis. Overrides unit-based defaults (e.g. 0 for percent)."
        },
        "y_max": {
          "type": "number",
          "description": "Explicit maximum value for the Y axis. Overrides unit-based defaults (e.g. 100 for percent)."
        },
        "thresholds": {
          "type": "array",
          "description": "Horizontal reference lines drawn on the chart.",
          "items": {
            "$ref": "#/$defs/threshold"
          }
        },
        "stacked": {
          "type": "boolean",
          "description": "Stack series on top of each other. Applies to line, area, and bar charts.",
          "default": false
        },
        "y_scale": {
          "type": "string",
          "description": "Y-axis scale type. Defaults to 'linear' if omitted.",
          "enum": ["linear", "log"],
          "default": "linear"
        },
        "span": {
          "type": "integer",
          "description": "Number of columns this panel occupies in the 12-column grid. When omitted, columns are distributed equally among panels. Use span: 12 for full-width.",
          "minimum": 1,
          "maximum": 12
        }
      },
      "required": ["title", "type", "query"],
      "additionalProperties": false
    },
    "threshold": {
      "type": "object",
      "description": "A horizontal threshold line on a graph panel.",
      "properties": {
        "value": {
          "type": "number",
          "description": "Y-axis value where the line is drawn."
        },
        "color": {
          "type": "string",
          "description": "CSS color for the line. Defaults to '#ef4444' (red) when omitted.",
          "default": "#ef4444"
        },
        "label": {
          "type": "string",
          "description": "Text label displayed at the end of the line."
        }
      },
      "required": ["value"],
      "additionalProperties": false
    },
    "markdownPanel": {
      "type": "object",
      "description": "A panel that renders Markdown content.",
      "properties": {
        "title": {
          "type": "string",
          "description": "Display title of the panel."
        },
        "type": {
          "const": "markdown"
        },
        "content": {
          "type": "string",
          "description": "Markdown text to render."
        },
        "span": {
          "type": "integer",
          "description": "Number of columns this panel occupies in the 12-column grid. When omitted, columns are distributed equally among panels. Use span: 12 for full-width.",
          "minimum": 1,
          "maximum": 12
        }
      },
      "required": ["title", "type", "content"],
      "additionalProperties": false
    }
  }
}
