title: "Background Jobs"
rows:
  - title: "Overview"
    panels:
      - title: "Background Jobs"
        type: markdown
        content: |
          Background job processing metrics.
          Monitors queue depth, processing rate, and job duration across queues: email, export, cleanup.
        span: 12

  - title: "Queue Depth"
    panels:
      - title: "Pending Jobs by Queue"
        type: graph
        query: 'myapp_jobs_queue_depth'
        unit: count
        chart_type: area
        stacked: true
        legend: "{queue}"
        y_min: 0

  - title: "Processing Rate"
    panels:
      - title: "Jobs Processed (Success)"
        type: graph
        query: 'sum by (queue)(rate(myapp_jobs_processed_total{status="success"}[5m]))'
        unit: count
        chart_type: bar
        legend: "{queue}"
        y_min: 0
      - title: "Jobs Processed (Failure)"
        type: graph
        query: 'sum by (queue)(rate(myapp_jobs_processed_total{status="failure"}[5m]))'
        unit: count
        chart_type: bar
        legend: "{queue}"
        y_min: 0

  - title: "Job Failure Ratio"
    panels:
      - title: "Failure Ratio by Queue"
        type: graph
        query: 'sum by (queue)(rate(myapp_jobs_processed_total{status="failure"}[5m])) / (sum by (queue)(rate(myapp_jobs_processed_total[5m])) > 0) * 100'
        unit: percent
        legend: "{queue}"
        y_min: 0
        thresholds:
          - value: 5
            color: "#f59e0b"
            label: "5% Failures"
          - value: 20
            color: "#ef4444"
            label: "20% Failures"

  - title: "Job Duration"
    panels:
      - title: "Job Duration p99 by Queue"
        type: graph
        query: 'histogram_quantile(0.99, sum by (le, queue)(rate(myapp_jobs_duration_seconds_bucket[5m])))'
        unit: seconds
        legend: "{queue}"
        y_min: 0
      - title: "Average Job Duration by Queue"
        type: graph
        query: 'sum by (queue)(rate(myapp_jobs_duration_seconds_sum[5m])) / (sum by (queue)(rate(myapp_jobs_duration_seconds_count[5m])) > 0)'
        unit: seconds
        legend: "{queue}"
        y_min: 0
