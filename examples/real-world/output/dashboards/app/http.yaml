title: "Application HTTP"
variables:
  - name: path
    label: "Path"
    query: "label_values(myapp_http_requests_total, path)"
rows:
  - title: "Overview"
    panels:
      - title: "Application HTTP"
        type: markdown
        content: |
          HTTP request metrics from the application (dummyapp).
          Organized by the **RED method**: Rate, Errors, and Duration.
        span: 12

  - title: "Rate"
    panels:
      - title: "Request Rate by Method"
        type: graph
        query: 'sum by (method)(rate(myapp_http_requests_total{path="$path"}[5m]))'
        unit: count
        chart_type: bar
        legend: "{method}"
        y_min: 0
      - title: "Request Rate by Status"
        type: graph
        query: 'sum by (status)(rate(myapp_http_requests_total{path="$path"}[5m]))'
        unit: count
        chart_type: bar
        legend: "{status}"
        y_min: 0

  - title: "Errors"
    panels:
      - title: "Error Rate (5xx)"
        type: graph
        query: 'sum(rate(myapp_http_requests_total{status="500", path="$path"}[5m]))'
        unit: count
        chart_type: bar
        y_min: 0
      - title: "Error Ratio"
        type: graph
        query: 'sum(rate(myapp_http_requests_total{status="500", path="$path"}[5m])) / (sum(rate(myapp_http_requests_total{path="$path"}[5m])) > 0) * 100'
        unit: percent
        y_min: 0
        thresholds:
          - value: 1
            color: "#f59e0b"
            label: "1% Errors"
          - value: 5
            color: "#ef4444"
            label: "5% Errors"

  - title: "Duration"
    panels:
      - title: "Request Duration p99"
        type: graph
        query: 'histogram_quantile(0.99, sum by (le)(rate(myapp_http_request_duration_seconds_bucket{path="$path"}[5m])))'
        unit: seconds
        y_min: 0
      - title: "Request Duration p95"
        type: graph
        query: 'histogram_quantile(0.95, sum by (le)(rate(myapp_http_request_duration_seconds_bucket{path="$path"}[5m])))'
        unit: seconds
        y_min: 0

  - title: "Duration by Path"
    panels:
      - title: "p99 Latency by Path"
        type: graph
        query: 'histogram_quantile(0.99, sum by (le, path)(rate(myapp_http_request_duration_seconds_bucket[5m])))'
        unit: seconds
        legend: "{path}"
        y_min: 0
      - title: "Average Duration by Path"
        type: graph
        query: 'sum by (path)(rate(myapp_http_request_duration_seconds_sum[5m])) / (sum by (path)(rate(myapp_http_request_duration_seconds_count[5m])) > 0)'
        unit: seconds
        legend: "{path}"
        y_min: 0

  - title: "In-Flight"
    panels:
      - title: "Requests In-Flight"
        type: graph
        query: 'myapp_http_requests_in_flight'
        unit: count
        y_min: 0
