title: "Host Metrics"
variables:
  - name: device
    label: "Disk Device"
    query: "label_values(system_disk_io_bytes_total, device)"
rows:
  - title: "Overview"
    panels:
      - title: "Host Metrics"
        type: markdown
        content: |
          Host-level resource metrics collected by the OpenTelemetry host metrics receiver.
          Organized by the **USE method**: Utilization, Saturation, and Errors for each resource (CPU, Memory, Disk, Network).
        span: 12

  - title: "CPU"
    panels:
      - title: "CPU Time by State"
        type: graph
        query: 'sum by (state)(rate(system_cpu_time_seconds_total[5m]))'
        unit: count
        chart_type: area
        stacked: true
        legend: "{state}"
        y_min: 0
      - title: "CPU User + System Usage"
        type: graph
        query: 'sum(rate(system_cpu_time_seconds_total{state=~"user|system"}[5m])) / sum(rate(system_cpu_time_seconds_total[5m])) * 100'
        unit: percent
        y_min: 0
        y_max: 100
        thresholds:
          - value: 80
            color: "#f59e0b"
            label: "Warning"
          - value: 95
            color: "#ef4444"
            label: "Critical"

  - title: "Memory"
    panels:
      - title: "Memory Usage by State"
        type: graph
        query: 'system_memory_usage_bytes'
        unit: bytes
        chart_type: area
        stacked: true
        legend: "{state}"
        y_min: 0
      - title: "Used Memory"
        type: graph
        query: 'system_memory_usage_bytes{state="used"}'
        unit: bytes
        y_min: 0
        thresholds:
          - value: 1073741824
            color: "#f59e0b"
            label: "1 GB"

  - title: "Disk I/O - $device"
    repeat: device
    panels:
      - title: "Disk I/O Throughput ($device)"
        type: graph
        query: 'rate(system_disk_io_bytes_total{device="$device"}[5m])'
        unit: bytes
        chart_type: area
        legend: "{direction}"
        y_min: 0
      - title: "Disk IOPS ($device)"
        type: graph
        query: 'rate(system_disk_operations_total{device="$device"}[5m])'
        unit: count
        chart_type: bar
        legend: "{direction}"
        y_min: 0

  - title: "Disk Latency & Queue - $device"
    repeat: device
    panels:
      - title: "Disk I/O Time ($device)"
        type: graph
        query: 'rate(system_disk_io_time_seconds_total{device="$device"}[5m])'
        unit: seconds
        y_min: 0
      - title: "Pending Operations ($device)"
        type: graph
        query: 'system_disk_pending_operations{device="$device"}'
        unit: count
        y_min: 0
      - title: "Weighted I/O Time ($device)"
        type: graph
        query: 'rate(system_disk_weighted_io_time_seconds_total{device="$device"}[5m])'
        unit: seconds
        y_min: 0

  - title: "Network I/O"
    panels:
      - title: "Network Throughput"
        type: graph
        query: 'rate(system_network_io_bytes_total[5m])'
        unit: bytes
        chart_type: area
        legend: "{device} {direction}"
        y_min: 0
      - title: "Network Packets"
        type: graph
        query: 'rate(system_network_packets_total[5m])'
        unit: count
        chart_type: area
        legend: "{device} {direction}"
        y_min: 0

  - title: "Network Errors"
    panels:
      - title: "Network Errors"
        type: graph
        query: 'rate(system_network_errors_total[5m])'
        unit: count
        chart_type: bar
        legend: "{device} {direction}"
        y_min: 0
      - title: "Network Drops"
        type: graph
        query: 'rate(system_network_dropped_total[5m])'
        unit: count
        chart_type: bar
        legend: "{device} {direction}"
        y_min: 0

  - title: "TCP Connections"
    panels:
      - title: "TCP Connections by State"
        type: graph
        query: 'system_network_connections{protocol="tcp"}'
        unit: count
        chart_type: area
        stacked: true
        legend: "{state}"
        y_min: 0
        legend_position: right
        legend_max_width: 120
